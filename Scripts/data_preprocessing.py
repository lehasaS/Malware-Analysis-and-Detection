# Lehasa Seoe
# 25 August 2022
# Script to split folders
import pathlib
import os
import splitfolders
import argparse


def main(filepath):
    print("===================== Splitting files =====================")
    splitfolders.ratio(filepath, output="output", seed=1337, ratio=(.8, 0.1, 0.1))
    data_dir = pathlib.Path(os.path.normpath('output'))
    train_path = data_dir / "train"
    val_path = data_dir / "val"
    test_path = data_dir/"test"
    print("===================== Done =====================")
    malware_train = len(os.listdir(train_path / "Malicious"))
    benign_train = len(os.listdir(train_path / "Benign"))
    malware_valid = len(os.listdir(val_path / "Malicious"))
    benign_valid = len(os.listdir(val_path / "Benign"))
    malware_test = len(os.listdir(test_path / "Malicious"))
    benign_test = len(os.listdir(test_path / "Benign"))
    print("===================== Number of files in each folder  =====================")
    print("Malware Train Images: {}".format(malware_train))
    print("Benign Train Images: {}".format(benign_train))
    print("Malware Validation Images: {}".format(malware_valid))
    print("Benign Validation Images: {}".format(benign_valid))
    print("Malware Test Images: {}".format(malware_test))
    print("Benign Test Images: {}".format(benign_test))


if __name__ == "__main__":
    parser = argparse.ArgumentParser(prog='data_processing.py', description="Splits data into training, validation and test sets")
    parser.add_argument(dest='input_dir', help='Input directory of directories with the data set')
    args = parser.parse_args()
    main(args.input_dir)
    print("===================== Shuffling and Splitting Successful! =====================")